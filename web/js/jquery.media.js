!function(t,i,a){function e(t){this.settings=t,this.tag="",this.search="",this.pagination=1,this.selectors=[],this.cache=[],this.init()}e.prototype={init:function(){this.initTags(),this.initSearch(),this.initPagination(),this.initSelector(),this.initZoom()},initTags:function(){var i=this;t(i.settings.tag.container).unbind("click").click(function(a){a.preventDefault(),i.tag=t(this).attr(i.settings.tag.attribute),i.pagination=1,i.refresh(t(this).attr("data-selector"))})},initSearch:function(){var i=this;t(i.settings.search.container).closest("form").unbind("submit").submit(function(a){a.preventDefault(),i.search=t(this).find(i.settings.search.field).val(),i.pagination=1,i.refresh(t(this).attr("data-selector"))})},initPagination:function(){var i=this;t("a["+i.settings.pagination.attribute+"]").unbind("click").click(function(a){return 0!=t(this).attr("data-active")&&(t("li.pagination-loader").show("fast"),i.pagination=t(this).attr(i.settings.pagination.attribute),void i.refresh(t(this).attr("data-selector")))})},initSelector:function(){var i=this,a=0;t(i.settings.selector.container).each(function(){if(i.cache[t(this).attr("data-id")]={id:t(this).attr("data-id"),"private":t(this).attr("data-private"),root:t(this).attr("data-root"),filter:t(this).attr("data-filter"),index:a},t(this).removeAttr("data-private").removeAttr("data-root").removeAttr("data-filter"),t(this).hasClass("disabled"))t(this).unbind("click").click(function(t){return t.preventDefault(),!1});else{if(""!=t("#"+t(this).attr("data-id")).val()){var e=this;t.ajax({type:"POST",url:i.settings.clickable.initialization,data:{id:t("#"+t(this).attr("data-id")).val()},success:function(a){t(e).find(i.settings.selector["default"]).hide(),t(e).find(i.settings.selector.preview).html(a).show(),t(i.settings.reset.container+"[data-id="+t(e).attr("data-id")+"]").show(),i.initReset(),i.initTarget(e)}})}t(this).attr("data-selector",a).unbind("click").click(function(a){var e=this;t.ajax({type:"POST",url:i.settings.selector.initialization,data:{selector:{index:t(e).attr("data-selector"),filter:i.cache[t(this).attr("data-id")].filter,root:i.cache[t(this).attr("data-id")].root,"private":i.cache[t(this).attr("data-id")]["private"],selected:t("#"+t(this).attr("data-id")).val(),"new":t(this).attr("data-reveal-id")+"-new"}},success:function(a){t("#"+t(e).attr("data-reveal-id")).html(a),i.initTags(),i.initPagination(),i.initSearch(),i.initClickable(),i.initReset(),i.initNew(),i.initTarget(e),i.refreshSelector(t(e).attr("data-selector"))}})}),i.selectors.push(this),a+=1}})},initClickable:function(){var i=this;t(i.settings.clickable.container).unbind("click").click(function(a){t("#"+t(i.selectors[t(this).attr("data-selector")]).attr("data-id")+"-field").val(t(this).attr("media-id")),t("#"+t(i.selectors[t(this).attr("data-selector")]).attr("data-id")).val(t(this).attr("media-id")).trigger("change")})},initZoom:function(){var i=this;t(i.settings.zoom.container).unbind("click").click(function(a){a.preventDefault();var e=this;t.ajax({type:"POST",url:i.settings.zoom.initialization,data:{id:t(e).attr("media-id")},success:function(a){t("#"+t(e).attr("data-reveal-id")).find("."+i.settings.zoom.attribute).html(a)}})})},initReset:function(){var i=this;t(i.settings.reset.container).unbind("click").click(function(i){i.preventDefault(),t("#"+t(this).attr("data-id")+"-field").val(""),t("#"+t(this).attr("data-id")).val("").trigger("change")})},initNew:function(){var i=this;t(i.settings["new"].container).unbind("click").click(function(a){var e=this;t.ajax({type:"POST",url:i.settings["new"].initialization,data:{selector:{index:t(e).attr("data-selector"),selector:t(i.selectors[t(e).attr("data-selector")]).attr("data-reveal-id"),target:i.cache[t(i.selectors[t(e).attr("data-selector")]).attr("data-id")].id,filter:i.cache[t(i.selectors[t(e).attr("data-selector")]).attr("data-id")].filter,root:i.cache[t(i.selectors[t(e).attr("data-selector")]).attr("data-id")].root,"private":i.cache[t(i.selectors[t(e).attr("data-selector")]).attr("data-id")]["private"]}},success:function(a){t("#"+t(i.selectors[t(e).attr("data-selector")]).attr("data-reveal-id")+"-new").html(a)}})})},initTarget:function(i){var a=this;t("#"+t(i).attr("data-id")).change(function(){var e=t(this).val();""==e?(t(i).find(a.settings.selector["default"]).show(),t(i).find(a.settings.selector.preview).hide(),t(a.settings.reset.container+"[data-id="+t(i).attr("data-id")+"]").hide()):t.ajax({type:"POST",url:a.settings.clickable.initialization,data:{id:e},success:function(e){t(i).find(a.settings.selector["default"]).hide(),t(i).find(a.settings.selector.preview).html(e).show(),t(a.settings.reset.container+"[data-id="+t(i).attr("data-id")+"]").show()}}),t("#"+t(a.selectors[t(i).attr("data-selector")]).attr("data-reveal-id")).foundation("reveal","close")})},refresh:function(i){var a=this;t.ajax({type:"POST",url:t(a.settings.container).attr("data-path"),data:{media:{tag:this.tag,search:this.search,pagination:this.pagination},selector:{filter:"undefined"!=typeof i?a.cache[t(a.selectors[i]).attr("data-id")].filter:null,root:"undefined"!=typeof i?a.cache[t(a.selectors[i]).attr("data-id")].root:null,"private":"undefined"!=typeof i?a.cache[t(a.selectors[i]).attr("data-id")]["private"]:null,selected:"undefined"!=typeof i?t("#"+t(a.selectors[i]).attr("data-id")).val():null,"new":"undefined"!=typeof i?t(a.selectors[i]).attr("data-reveal-id")+"-new":null}},success:function(e){if("undefined"!=typeof i){var n=t("#"+t(a.selectors[i]).attr("data-reveal-id"));n.find(a.settings.container).fadeToggle(400,"linear",function(){n.find(a.settings.container).html(a.getHtml(e,a.settings.container)).fadeToggle(400,"linear"),a.initTags(),a.initPagination(),a.initClickable(),a.initNew(),a.initZoom(),a.refreshSelector(i)})}else t(a.settings.container).fadeToggle(400,"linear",function(){t(a.settings.container).html(a.getHtml(e,a.settings.container)).fadeToggle(400,"linear"),a.initTags(),a.initPagination(),a.initClickable(),a.initNew(),a.initZoom()})}})},refreshSelector:function(i){var a=this,e=t("#"+t(a.selectors[i]).attr("data-reveal-id"));e.find(a.settings.pagination.container).attr("data-selector",i),e.find(a.settings.tag.container).attr("data-selector",i),e.find(a.settings.search.container).closest("form").attr("data-selector",i),e.find(a.settings.clickable.container).attr("data-selector",i),e.find(a.settings["new"].container).attr("data-selector",i),t(a.settings.reset.container+"[data-id="+t(a.selectors[i]).attr("data-id")+"]").attr("data-selector",i)},getHtml:function(i,a){var e=t(t.parseHTML(i));return e.filter(a).add(e.find(a)).html()}},t.fn.media=function(i){var a=t.extend({container:".media",tag:{container:"a[media-tag]",attribute:"media-tag"},search:{container:"input[data-type=search]",field:".FhmSearch_search"},pagination:{container:"a[media-pagination]",attribute:"media-pagination"},clickable:{container:".data.clickable",initialization:"/api/media/data/preview"},zoom:{container:"a[media-zoom]",attribute:"media-zoom",initialization:"/api/media/data/zoom"},reset:{container:".media-reset"},selector:{container:".media-selector",initialization:"/api/media/data/selector","default":".default",preview:".preview"},"new":{container:".media-new",modal:"modal-media-new",initialization:"/api/media/data/new"}},i);new e(a)}}(jQuery,window,window.document);