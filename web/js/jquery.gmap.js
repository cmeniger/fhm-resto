!function(t,e,n){function r(t){this.settings=t,this.page=1,this.step=0,this.count=0,this.current=0,this.map=null,this.markers=[],this.clusterer=null,this.play=!0,this.init()}r.prototype={init:function(){this.initLocale()},initMap:function(){this.mapCanvas=n.getElementById(this.settings.anchors.map),this.map=new google.maps.Map(this.mapCanvas,this.settings.map),this.infowindow=new google.maps.InfoWindow,this.mapCanvas.gMap=this.map,this.settings.map.cluster&&(this.clusterer=new MarkerClusterer(this.map,[],this.settings.cluster)),this.initError(),this.initCounter(),this.initAroundme()},initError:function(){var e=this;t("body").append('<div id="'+e.settings.error.modal+'" class="reveal-modal tiny modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog"><div id="'+e.settings.error.content+'"></div><a class="close-reveal-modal" aria-label="Close">&#215;</a></div>')},initCounter:function(){var e=this;t.ajax({type:"GET",url:e.settings.url.counter,success:function(t){e.page=t.page,e.step=t.step,e.count=t.count,e.addCounter(),e.addMarkers()}})},initLocale:function(){var t=this;if(t.settings.map.locale){var e=function(e){t.settings.map.center.lat=e.coords.latitude,t.settings.map.center.lng=e.coords.longitude,t.initMap()},n=function(e){console.warn("ERROR("+e.code+"): "+e.message),t.initMap()};navigator.geolocation?navigator.geolocation.getCurrentPosition(e,n,t.settings.aroundme):t.initMap()}else t.initMap()},initAroundme:function(){var e=this;if(e.settings.map.aroundme){var n=new google.maps.Marker({position:null,map:e.map,draggable:!1,visible:!1,icon:"/images/marker-aroundme.png"}),r=function(t){var r=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);n.setPosition(r),n.setVisible(!0),e.map.setCenter(r),e.map.setZoom(17)},a=function(n){console.warn("ERROR("+n.code+"): "+n.message),t("#"+e.settings.error.content).html(e.settings.error.text.geolocation),t("#"+e.settings.error.modal).foundation("reveal","open")};t("#"+e.settings.anchors.aroundme).click(function(t){navigator.geolocation&&navigator.geolocation.getCurrentPosition(r,a,e.settings.aroundme)})}else t("#"+e.settings.anchors.aroundme).hide()},addCounter:function(){var e=this,n=0==e.count?100:Math.floor(100*e.current/e.count),r=t("#"+e.settings.anchors.counter),a=n>=100?"refresh":e.play?"pause":"play";e.settings.map.counter&&(r.html(""),e.settings.counter.refresh&&r.append("<div class='actions'><i class='fa fa-"+a+"' id='counter-play'></i></div>"),e.settings.counter.progressbar&&r.append("<div class='progressbar'><div class='bar'><div class='current' style='width:"+n+"%;'></div></div><div class='text'>"+n+"%</div></div>"),e.settings.counter.count&&r.append("<div class='count'>"+e.current+" / "+e.count+"</div>"),t("#counter-play").click(function(t){e.play=!e.play,n>=100?(e.current=0,e.page=1,e.play=!0,e.settings.map.cluster&&(e.clusterer=new MarkerClusterer(e.map,[],e.settings.cluster)),e.removeMarkers(),e.initCounter()):(e.addCounter(),e.addMarkers())}))},addMarkers:function(){var e=this;t.ajax({type:"GET",url:e.settings.url.marker,data:{page:e.page,step:e.step},success:function(t){e.current+=t.length,e.page+=1,e.current<e.count&&e.play&&e.addMarkers();for(var n=0;n<t.length;n++){var r=new google.maps.Marker({position:new google.maps.LatLng(t[n].lat,t[n].lng),map:e.map,title:t[n].name,draggable:!1,visible:!0,icon:"/images/marker.png"});e.markers.push(r),e.addPopup(r,t[n].id)}e.settings.map.cluster&&e.current>=e.count&&(e.clusterer=new MarkerClusterer(e.map,e.markers,e.settings.cluster)),e.addCounter()}})},removeMarkers:function(){for(var t=this,e=0;e<t.markers.length;e++)t.markers[e].setMap(null);t.markers=[]},addPopup:function(e,n){var r=this;google.maps.event.addListener(e,"click",function(){r.infowindow.close(),r.infowindow.setContent("<i class='fa fa-refresh fa-spin' style='font-size:30px;'></i>"),r.infowindow.open(r.map,e),t.ajax({type:"GET",url:r.settings.url.popup,data:{id:n},success:function(t){r.infowindow.setContent(t)}})})}},t.fn.gmap=function(e){var n=t.extend({anchors:{map:"map-canvas",counter:"map-counter",aroundme:"map-aroundme"},url:{counter:"",marker:"",popup:""},map:{center:{lat:46,lng:5},zoom:5,scrollwheel:!0,panControl:!0,rotateControl:!0,scaleControl:!0,streetViewControl:!0,mapTypeControl:!0,overviewMapControl:!0,zoomControl:!0,counter:!0,aroundme:!0,locale:!0,cluster:!1,styles:[]},counter:{refresh:!0,progressbar:!0,count:!0},aroundme:{enableHighAccuracy:!0,timeout:5e3,maximumAge:0},cluster:{gridSize:50,maxZoom:15,zoomOnClick:!1,styles:[{url:"/images/clusters_03.png",textColor:"white",fontWeight:"light",textSize:14,width:50,height:50},{url:"/images/clusters_02.png",textColor:"white",fontWeight:"light",textSize:15,width:50,height:50},{url:"/images/clusters_01.png",textColor:"white",fontWeight:"light",textSize:16,width:50,height:50}]},error:{modal:"map-error",content:"map-error-content",text:{geolocation:""}}},e);new r(n)}}(jQuery,window,window.document);